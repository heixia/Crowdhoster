<ul class="bootcamplist">
<% Bootcamp.all.each do |camp| %>
<li class="bootcamp-li" id="<%= camp.name.gsub(" ","-").downcase %>link" data-primary_language="<%= camp.primary_language %>"><%= link_to("#{camp.name}", camp )  %></li>
<% end %>
<button id="rubyfilter" class="small">RUBY</button><button id = "jsfilter" class="small">JAVASCRIPT</button><button id = "allfilter" class="small">ALL</button>

<style>

path {
  stroke: teal;
  stroke-width:1px;
  fill: grey;
    }

#main ul.bootcamplist {
  float: right;
  font-size: 1.2em;
  margin-right: 2%;
    
}

.bootcamp-li{border-bottom: 1px solid grey;
}

</style>




<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<%= javascript_include_tag "jquery.tipsy.js" %>
<%= javascript_include_tag "jquery.pulse.js" %>
<script src="http://d3js.org/topojson.v1.min.js"></script>



<script>
// set the size of our map
var width = 800;
    height = 650;

// set up the view of the map
// projections adjusts the display for 2D screens. 
// projections distory land size and shape, choose wisely
// Mercator is conservative option 
var projection = d3.geo.mercator()
    .center([80,40]) // default [0,0], North America [100,30]
    .scale(700)    // default (150). zoom in w/ > values
    .rotate([-190,0]); // [longitude, latitude, roll], def [0,0,0]

// create svg window
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
// geo path generator used to specify projection type
var path = d3.geo.path()
    .projection(projection);
// g is our appended svg
var g = svg.append("g");



// load and display the world, draws the map for us.
d3.json("/assets/world.json", function(error, topology) {
    g.selectAll("path")
        .data(topojson.feature(topology, topology.objects.countries)
            .features) // data that defines countries
      .enter()
        .append("path") // act on all path elements
        .attr("d", path); // add data we're going to display

// add our bootcamps to their geo-location

<% @bootcamps.each_with_index do |camp, index| %>
var lat = (<%= camp.lat %>);
var lon = (<%= camp.lon %>);
var coords = projection([lon,lat]);

// template for adding cities with Ruby script 
g.append("circle")
    .attr("class", "logo")
    .attr("data-primary_language", "<%= camp.primary_language %>")
    .attr("id", "<%= camp.name.gsub(" ","-").downcase %>")
    .attr("data-name", "<%= camp.name %>")
    .attr("data-city", "<%= camp.city %>")
    .attr("cx", coords[0])
    .attr("cy", coords[1])
    .attr("r", 10)
    .attr("fill", "url(#image<%= index %>)")
    .attr("stroke", "white")
    .attr("stroke-width", 0.25)
    .on("mouseover", function(){ 
      d3.select(this)
         .transition().attr("r", 20).duration(50)
         .style("fill", "url(#hoverimage<%= index %>)")
         
     })
     .on("mouseout", function(){ 
      d3.select(this)
         .transition().attr("r", 10).duration(50)
         .style("fill", "url(#image<%= index %>)");
     })
     


    <% end %>

$('svg circle').tipsy({ 
        gravity: 's', 
        fade:true,
        fallback:"bootcamp",
        html: true, 
        title: function() {
          circle='#'+this.id
          name = $(circle).attr("data-name")
          city = $(circle).attr("data-city")
          return name+"<br/>("+city+")"
        }
});

$('svg circle').on("click", function() {
  document.location = "/bootcamps/" + this.id;
});

$(".bootcamp-li").on("mouseover", function(){
  var d = this.id.slice(0,-4);
  var bootcamp = $("#"+d);
  $("#"+d).attr("stroke", "purple").attr("stroke-width", 5);
});

$(".bootcamp-li").on("mouseout", function(){
  var d = this.id.slice(0,-4);
  $("#"+d).attr("stroke", "white").attr("stroke-width", .25);
})


$('#rubyfilter').on("click", function() {
  $('svg circle').show();
  $('svg circle').not("[data-primary_language='ruby']").hide( "drop", { direction: "down" }, "slow" );
  $(".bootcamp-li").hide();
  // $("[data-primary_language='ruby']").show("fade");

}); 

$('#jsfilter').on("click", function() {
  $('svg circle').show();
  $('svg circle').not("[data-primary_language='javascript']").hide( "drop", { direction: "down" }, "slow" );
  $(".bootcamp-li").hide();
}); 

$("#allfilter").on("click", function(){
  $('svg circle').show();
  $(".bootcamp-li").show()
});
});




// moving and panning on the map: 
// var zoom = d3.behavior.zoom()
//     .scaleExtent([1,9])
//     .on("zoom", move); 

// svg.call(zoom)

// LIMITING THE RANGE OF ZOOMING BY SCROLL 
// function move() {
//   var t = d3.event.translate,
//       s = d3.event.scale;

//   t[0] = Math.min(width / 2 * (s - 1), Math.max(width / 2 * (1 - s), t[0]));
//   t[1] = Math.min(height / 2 * (s - 1) + 230 * s, Math.max(height / 2 * (1 - s) - 230 * s, t[1]));
//   zoom.translate(t);
//   g.style("stroke-width", 1 / s).attr("transform", "translate(" + t + ")scale(" + s + ")");
// }


</script>
<svg id="logos" width="80" height="80">
  <defs id="mydefs">
  <% @bootcamps.each_with_index do |camp, index| %>
    <pattern id="image<%= index %>" x="0" y="0" height="40" width="40">
      <image width="20" height="20" xlink:href="<%= image_path(camp.name.downcase.gsub(" ", "-")+'.png') %>"></image>
    </pattern>
  <% end %>
  </defs>

<svg id="hoverlogos" width="160" height="160">
  <defs id="mydefs">
    <% @bootcamps.each_with_index do |camp, index| %>
    <pattern id="hoverimage<%= index %>" x="0" y="0" height="80" width="80">
      <image width="40" height="40" xlink:href="<%= image_path(camp.name.downcase.gsub(" ", "-")+'.png') %>"></image>
    </pattern>
  <% end %>
  </defs>


<!-- est. pattern for logos to insert into d3 circle object -->
<!-- <svg id="mySvg" width="80" height="80">
  <defs id="mydefs">
    <pattern id="image" x="0" y="0" height="40" width="40">
      <image width="20" height="20" xlink:href=urlImagePath></image>
    </pattern>

    <pattern id="image1" x="0" y="0" height="40" width="40">
      <image width="20" height="20" xlink:href="http://scm-l3.technorati.com/12/12/13/73853/devbootcamp.png?t=20121213131231
"></image>
    </pattern>

    <pattern id="image2" x="0" y="0" height="40" width="40">
      <image width="20" height="20" xlink:href="http://cdn.skilledup.com/wp-content/uploads/2013/08/hacker-school.jpg"></image>
    </pattern>
  </defs> -->



</script>



